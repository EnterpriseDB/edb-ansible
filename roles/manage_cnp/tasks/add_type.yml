---
- name: Validate cnpg_namespace
  ansible.builtin.fail:
    fail: msg="The variable 'cnpg_namespace' is not defined and empty"
  when: (cnpg_namespace is defined) and (cnpg_namespace | length < 1)

- name: Validate pod_name
  ansible.builtin.fail:
    fail: msg="The variable 'pod_name' is not defined and empty"
  when: (pod_name is defined) and (pod_name | length < 1)

- name: Validate db_name
  ansible.builtin.fail:
    fail: msg="The variable 'db_name' is not defined and empty"
  when: (db_name is defined) and (db_name | length < 1)

- name: Validate add_type1_sql
  ansible.builtin.fail:
    fail: msg="The variable 'add_type1_sql' is not defined and empty"
  when: (add_type1_sql is defined) and (add_type1_sql | length < 1)

- name: Validate add_type2_sql
  ansible.builtin.fail:
    fail: msg="The variable 'add_type2_sql' is not defined and empty"
  when: (add_type2_sql is defined) and (add_type2_sql | length < 1)

- name: Add a Type
  kubernetes.core.k8s_exec:
    namespace: "{{ cnpg_namespace }}"
    pod: "{{ pod_name }}"
    command: psql -d "{{ db_name }}" -c "{{ add_type1_sql }}"

- name: Add a Table that references the Type
  kubernetes.core.k8s_exec:
    namespace: "{{ cnpg_namespace }}"
    pod: "{{ pod_name }}"
    command: psql -d "{{ db_name }}" -c "{{ add_type2_sql }}"
