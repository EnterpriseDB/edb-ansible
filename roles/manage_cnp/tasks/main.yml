---
# tasks file for role: manage_cnp
# Options"
# add-db, add-schema, add-role
# drop-db, drop-schema, drop-role
- name: cnp_task not defined in 'supported_tasks' list
  ansible.builtin.debug:
    msg: cnp_task - "{{ cnp_task }}" is not in supported_tasks list "{{ supported_tasks }}"
  when: cnp_task not in supported_tasks

- name: cnp_task not defined in 'supported_tasks' list
  ansible.builtin.fail:
  when: cnp_task not in supported_tasks

- name: Validate cnpg_namespace
  ansible.builtin.fail:
    fail: msg="The variable cnpg_namespace is not defined and empty"
  when:
    - cnpg_namespace is not defined
    - cnpg_namespace | length < 1

- name: Validate pod_name
  ansible.builtin.fail:
    fail: msg="The variable 'pod_name' is not defined and empty"
  when:
    - pod_name is not defined
    - pod_name | length < 1

- name: Validate db_name
  ansible.builtin.fail:
    fail: msg="The variable 'db_name' is not defined and empty"
  when:
    - db_name is not defined
    - db_name | length < 1

- name: Validate db_role
  ansible.builtin.fail:
    fail: msg="The variable 'db_role' is not defined and empty"
  when:
    - db_role is not defined
    - db_role | length < 1

- name: Validate db_role_password
  ansible.builtin.fail:
    fail: msg="The variable 'db_role_password' is not defined and empty"
  when:
    - db_role_password is not defined
    - db_role_password | length < 1

- name: Validate add_db_sql
  ansible.builtin.fail:
    fail: msg="The variable 'add_db_sql' is not defined and empty"
  when:
    - add_db_sql is not defined
    - add_db_sql | length < 1

- name: Add a Database
  ansible.builtin.include_tasks: add_db.yml
  when: cnp_task == "add-db"

- name: Add a Schema
  ansible.builtin.include_tasks: add_schema.yml
  when: cnp_task == "add-schema"

- name: Add a Role
  ansible.builtin.include_tasks: add_role.yml
  when: cnp_task == "add-role"

- name: Drop a Role
  ansible.builtin.include_tasks: drop_role.yml
  when: cnp_task == "drop-role"

- name: Drop a Schema
  ansible.builtin.include_tasks: drop_schema.yml
  when: cnp_task == "drop-schema"

- name: Drop a Database
  ansible.builtin.include_tasks: drop_db.yml
  when: cnp_task == "drop-db"
