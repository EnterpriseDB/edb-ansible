---
- name: Install additional supporting packages
  ansible.builtin.package:
    name:
      - bison
      - gcc
      - flex
      - patch
      - perf
      - psmisc
      - R-core
      - sysstat
      - tmux
    state: present
  when: ansible_os_family == "RedHat"
  become: true

- name: Install python3-docutils package for EL8
  ansible.builtin.package:
    name:
      - python3-docutils
    state: present
  when: ansible_os_family == "RedHat" and ansible_distribution_major_version == '8'

- name: Install python-docutils package for EL7
  ansible.builtin.package:
    name:
      - python-docutils
    state: present
  when: ansible_os_family == "RedHat" and ansible_distribution_major_version == '7'

- name: Install packages for DBT-7 Database for EL8
  ansible.builtin.dnf:
    name:
      - 'https://github.com/osdldbt/dbt7-packaging/releases/download/v{{ dbt7_version }}/dbt7-{{ dbt7_version }}-1.el8.x86_64.rpm'
    state: present
    disable_gpg_check: true
  when: ansible_os_family == "RedHat" and ansible_distribution_major_version == '8'
  become: true

- name: Download package for DBT-7 Database for EL7
  ansible.builtin.get_url:
    url: "https://github.com/osdldbt/dbt7/archive/refs/tags/v{{ dbt7_version }}.tar.gz"
    dest: "/usr/local/share/dbt7-v{{ dbt7_version }}.tar.gz"
    mode: '0644'
  when: ansible_os_family == "RedHat" and ansible_distribution_major_version == '7'
  become: true

- name: Install package for DBT-7 Database for EL7
  ansible.builtin.unarchive:
    src: "/usr/local/share/dbt7-v{{ dbt7_version }}.tar.gz"
    dest: "/usr/local/bin"
    remote_src: true
  when: ansible_os_family == "RedHat" and ansible_distribution_major_version == '7'
  become: true
