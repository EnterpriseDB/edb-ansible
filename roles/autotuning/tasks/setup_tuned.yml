---

- name: Set the variable tuned_disk_elevator for CentOS/RHEL 7
  set_fact:
    tuned_disk_elevator: "deadline"
  when:
    - os in ['CentOS7', 'RHEL7']

- name: Set the variable tuned_disk_elevator for CentOS/RHEL 8
  set_fact:
    tuned_disk_elevator: "mq-deadline"
  when:
    - os in ['CentOS8', 'RHEL8']

- name: Ensure the tuned profile directory exists
  file:
    path: "{{ tuned_configuration_dir }}/{{ tuned_profile }}"
    state: directory
    owner: "root"
    group: "root"
    mode: 0700
  become: yes

- name: Ensure tuned profile configuration exists
  template:
    src: "tuned.conf.template"
    dest: "{{ tuned_configuration_dir }}/{{ tuned_profile }}/tuned.conf"
    owner: "root"
    group: "root"
    mode: 0600
  become: true

- name: Ensure tuned profile is active
  command: tuned-adm profile {{ tuned_profile }}
  become: true
  changed_when: false
