---
- name: Install packages for Touchstone
  ansible.builtin.package:
    name:
      - cmake
      - gcc
      - make
      - redhat-rpm-config
      - sysstat
    state: present
  become: true

- name: Download Touchstone
  ansible.builtin.get_url:
    url: https://gitlab.com/touchstone/touchstone/-/archive/v{{ touchstone_version }}/touchstone-v{{ touchstone_version }}.tar.gz
    dest: "{{ ansible_env.HOME }}"
    mode: '0644'

- name: Unpack Touchstone
  ansible.builtin.unarchive:
    src: "{{ ansible_env.HOME }}/touchstone-v{{ touchstone_version }}.tar.gz"
    dest: "{{ ansible_env.HOME }}"

- name: Build Touchstone
  community.general.make:
    chdir: "{{ ansible_env.HOME }}/touchstone-v{{ touchstone_version }}"
    target: release

- name: Install Touchstone
  community.general.make:
    chdir: "{{ ansible_env.HOME }}/touchstone-v{{ touchstone_version }}/build/release"
    target: install
  become: true
