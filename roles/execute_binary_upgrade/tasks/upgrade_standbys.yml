---
- name: Enable and start systemd service on primary
  ansible.builtin.systemd:
    name: "{{ new_pg_service }}"
    daemon_reload: true
    state: started
    enabled: true
  become: true
  when: "'primary' in group_names"

- name: Stop old_pg_service
  ansible.builtin.systemd:
    name: "{{ old_pg_service }}"
    state: stopped
    enabled: false
  become: true
  when: "'standby' in group_names"

- name: Include setup_replication role for standby's when not use_link_method
  ansible.builtin.include_role:
    name: setup_replication
  vars:
    pg_version: "{{ new_pg_version }}"
    pg_service: "{{ new_pg_service }}"
    pg_data: "{{ new_pg_data }}"
    use_validation: false
  when: "'standby' in group_names"

